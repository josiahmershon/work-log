## Work Log Entry: 2025-09-05

Clock in: 7:46 a.m.
Clock out: 5:28 p.m.

### Summary

Finalized the decision to use a deterministic composite (specifically, a SHA-256 hash (or similar) of the document content) as the 'doc_id' component. This approach ensures idempotency and simplifies change detection for the automated ingestion pipeline.

Created the table itself in the Postgres Docker container. 

The command I used was:

`CREATE TABLE vector_index (
    id SERIAL PRIMARY KEY,
    doc_id TEXT NOT NULL UNIQUE,
    source_path TEXT,
    department TEXT,
    security_level TEXT,
    allowed_groups TEXT[],
    last_updated_by TEXT,
    last_updated_at TIMESTAMP WITH TIME ZONE,
    chunk_text TEXT NOT NULL,
    embedding VECTOR(1536)
);`

The reasoning behind these options:

`doc_id TEXT NOT NULL UNIQUE`: Using TEXT for our SHA-256 hash. UNIQUE is critical; the database will physically prevent duplicate documents from being ingested. 

`allowed_groups TEXT[]`: Using a native PostgreSQL TEXT[] (array) is the key to our security model. It's highly efficient and lets us use the special && (overlap) operator to filter results based on a user's group memberships. Far superior to a simple string.

`embedding VECTOR(1536)`: The required type for pgvector. The dimension (1536) is a safe, standard choice that aligns with popular, high-performance embedding models. Easy to change if needed, but a solid starting point.

`id SERIAL PRIMARY KEY`: Standard best practice. Gives us a simple, reliable integer ID for internal database operations, separate from our doc_id.

The database should be ready. Will hand off to John for testing with various commands next week as I begin work on the software deployment of Chainlit and Langchain/DSPy.